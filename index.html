<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR.js Web App</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aframe/1.2.0/aframe.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ar.js/2.2.2/aframe-ar.js"></script>
    <script>
        AFRAME.registerComponent('ar-handler', {
            init: function () {
                if (!AFRAME.utils.device.isMobile()) {
                    document.querySelector('.desktop-message').style.display = 'block';
                }
                
                if (!navigator.xr) {
                    console.warn('WebXR non supportato su questo browser.');
                    document.querySelector('.webxr-message').style.display = 'block';
                } else {
                    navigator.xr.isSessionSupported('immersive-ar')
                        .then((supported) => {
                            if (!supported) {
                                console.warn('AR non supportata su questo dispositivo.');
                                document.querySelector('.ar-message').style.display = 'block';
                            }
                        })
                        .catch((error) => {
                            console.error('Errore nel controllo del supporto AR:', error);
                            document.querySelector('.error-message').style.display = 'block';
                        });
                }
            }
        });
    </script>
    <style>
        .message { display: none; position: fixed; top: 0; left: 0; width: 100%; padding: 10px; background: #f44336; color: white; text-align: center; z-index: 9999; }
    </style>
</head>
<body style="margin: 0; overflow: hidden;">
    <div class="message desktop-message">Questa applicazione funziona meglio su dispositivi mobili.</div>
    <div class="message webxr-message">Il tuo browser non supporta WebXR. Prova con un browser più recente.</div>
    <div class="message ar-message">Il tuo dispositivo non supporta la Realtà Aumentata.</div>
    <div class="message error-message">Si è verificato un errore. Ricarica la pagina o prova con un altro dispositivo.</div>

    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;" ar-handler>
        <a-marker preset="hiro">
            <a-box position="0 0.5 0" material="color: red;"></a-box>
        </a-marker>
        <a-entity camera></a-entity>
    </a-scene>
</body>
</html>